# Hostname for Grafana ingress â€“ override per environment
grafanaHostname: grafana.app.example.com

kube-prometheus-stack:
  grafana:
    adminPassword: ""  # Set via --set or values override

loki:
  deploymentMode: SingleBinary
  gateway:
    enabled: false
  loki:
    commonConfig:
      replication_factor: 1
    storage:
      type: filesystem
    limits_config:
      volume_enabled: true
    schemaConfig:
      configs:
        - from: "2024-01-01"
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: index_
            period: 24h
  singleBinary:
    replicas: 1
  backend:
    replicas: 0
  read:
    replicas: 0
  write:
    replicas: 0

alloy:
  configMap:
    content: |
      logging {
        level = "info"
      }

      discovery.kubernetes "pods" {
        role = "pod"
      }

      discovery.relabel "pods" {
        targets = discovery.kubernetes.pods.targets
        rule {
          source_labels = ["__meta_kubernetes_namespace"]
          target_label  = "namespace"
        }
        rule {
          source_labels = ["__meta_kubernetes_pod_name"]
          target_label  = "pod"
        }
        rule {
          source_labels = ["__meta_kubernetes_pod_container_name"]
          target_label  = "container"
        }
      }

      loki.source.kubernetes "pods" {
        targets    = discovery.relabel.pods.output
        forward_to = [loki.write.default.receiver]
      }

      loki.write "default" {
        endpoint {
          url = "http://{{ .Release.Name }}-loki:3100/loki/api/v1/push"
        }
      }
